traverse_to_nested_projects: false
auto_merge: false
pr_locks: true
comment_render_mode: basic
respect_layers: true

generate_projects:
  blocks:
    - block_name: shared
      terragrunt: true
      root_dir: "01-terraform-infra/envs/shared/"
      workflow: default
      include_patterns: ["01-terraform-infra/modules/ecr/**"]

    - block_name: dev
      terragrunt: true
      root_dir: "01-terraform-infra/envs/dev/"
      workflow: default
      include_patterns:
        - "01-terraform-infra/modules/**"
        - "01-terraform-infra/root.hcl"
        - "01-terraform-infra/envs/_env.hcl"

    - block_name: staging
      terragrunt: true
      root_dir: "01-terraform-infra/envs/staging/"
      workflow: default
      include_patterns:
        - "01-terraform-infra/modules/**"
        - "01-terraform-infra/root.hcl"
        - "01-terraform-infra/envs/_env.hcl"

    - block_name: prod
      terragrunt: true
      root_dir: "01-terraform-infra/envs/prod/"
      workflow: with-approval
      include_patterns:
        - "01-terraform-infra/modules/**"
        - "01-terraform-infra/root.hcl"
        - "01-terraform-infra/envs/_env.hcl"

  terragrunt_parsing:
    parallel: true
    createProjectName: true
    createWorkspace: true
    defaultWorkflow: default
    executionOrderGroups: true
    cascadeDependencies: false  
    triggerProjectsFromDirOnly: true 

workflows:
  default:
    plan:
      steps:
        - init
        - plan
    apply:
      steps:
        - init
        - apply
    workflow_configuration:
      on_pull_request_pushed: [digger plan]
      on_pull_request_closed: [digger unlock]
      on_commit_to_default: [digger unlock]

  with-approval:
    plan:
      steps:
        - init
        - plan
    apply:
      steps:
        - init
        - apply
    workflow_configuration:
      on_pull_request_pushed: [digger plan]
      on_pull_request_closed: [digger unlock]
      on_commit_to_default: [digger unlock]